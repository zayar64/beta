{% extends 'base.html' %}
{% load static %}
{% block title %} Weather {% endblock %}

{% block styles %}
<style>
* {
margin: 0;
padding: 0;
text-decoration: none;
text-transform: none;
border-box: none;
}

body {
height: 100%;
}

.inputBox{
display: flex;
flex-direction: row;
width: 69%;
margin: 40px 0px 0px 70px;
}

#location {
border: 1px solid black;
}

.btn {
border: 1px solid black;
}

.resultBox {
margin: 40px 0 0 70px;
}

#mainBox {
width: 85%;
border: 1px solid black;
border-radius: 29px;
padding: 18px 9px 9px 9px;
}

#mainBox h3 {
text-align: center;
}

#mainResult {
display: flex;
flex-direction: row;
}

#mainResult h2 {
margin-top: 29px;
}

#mainResult img {
margin-left: 20px;
}

.time {
display: flex;
flex-direction: row;
justify-content: space-around;
}

.time h5 {
margin-right: 10%;
}

.result {
margin-top: 10px;
width: 85%;
border: 1px solid black;
border-radius: 29px;
padding: 9px;
display: flex;
flex-direction: row;
}

.result .label {
width: 30%;
}

</style>
{% endblock %}

{% block content %}
<form  class="formBox">
{% csrf_token %}
<div  class="inputBox">
<input type="text" placeholder="Enter a location"  class="form-control"  id="location" autocomplete="off">
<button type="submit"  class="btn btn-send"><i class="fa-solid fa-magnifying-glass"></i></button>
</div>
</form>
<div  class="resultBox">
</div>

<script>
const formBox = document.querySelector(".formBox");
const btn = document.querySelector(".inputBox button");

formBox.addEventListener('submit', (event) => {
    event.preventDefault();
    
    const location = document.getElementById("location").value;
    fetch('', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
      body: new URLSearchParams({
        'csrfmiddlewaretoken': document.querySelector('[name=csrfmiddlewaretoken]').value,
        'location': location
      })
    })
      .then(response => response.json())
      .then(data => {
        document.querySelector("#location").value = "";
        if (data.passed === false){
    document.querySelector(".resultBox").innerHTML = `<div  id="mainBox">
        <h3>Invalid location!</h3>
        </div>`;
    }else{
        document.body.style.backgroundColor = data.theme;
        document.body.style.color = data.font_color;
        if (data.font_color === "white"){
        btn.innerHTML = `<i class="fas fa-search" style="color: #ffffff;"></i>`
        }else{
        btn.innerHTML = `<i class="fa-solid fa-magnifying-glass"></i>`
        }
        document.querySelector("#location").style.backgroundColor = data.theme;
        document.querySelector(".resultBox").innerHTML = `<div  id="mainBox">
        <h3>${data.location}</h3>
        <div  id="mainResult">
            <h2>${data.temperature}</h2>
            <img src=${data.weather_image} width="100" height="100">
        </div>
        <div class="time">
        <h5>${data.date}</h5>
        <h5>${data.current_time}</h5>
        </div>
    </div>
    <div  class="result">
        <div  class="label">Weather</div>
        <div>: ${data.weather}</div>
    </div>
    <div  class="result">
        <div  class="label">Feels Like</div>
        <div>: ${data.feels_like}</div>
    </div>
    <div  class="result">
        <div  class="label">Humidity</div>
        <div>: ${data.humidity}</div>
    </div>
    <div  class="result">
        <div  class="label">Wind</div>
        <div>: ${data.wind}</div>
    </div>
    `;
    }
      });
});
</script>
{% endblock%}